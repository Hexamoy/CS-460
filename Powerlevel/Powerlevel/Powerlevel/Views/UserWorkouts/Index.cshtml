@model IEnumerable<Powerlevel.Models.UserWorkout>
@using Powerlevel.Models

<style>
    #IndexButton {
        border: solid;
        color: black;
        padding: 12px 32px;
        text-align: center;
        text-decoration: none;
        font-size: 16px;
        font-family: 'Comic Sans MS';
        height: 50px;
        width: 260px;
    }

    #CurrWorkout {
        background-color: #6EFF69;
    }
</style>

@{
    ViewBag.Title = "Workout Select";
}

@if (Request.IsAuthenticated)
{
    <h1><span style="color:#FDFFAF">@User.Identity.Name</span>'s Workout Page</h1>
    <br />


    /* This segment of code checks if the logged in user has an active workout, if so, the "Resume Current" button will appear,
     * otherwise, a "Start New Workout" button appears */
    int loggedInId = 0;
    int currentWorkoutId = 0;

    foreach (var item in Model)
    {
        /* if the UserWorkout table has a user whose name matches the logged in user AND the Workout has not been completed (I.E., WorkoutCompleted field is "false")
         * then the loggedInId variable is set to that of the UserId so that the user is unable to start a new workout */
        if (item.User.UserName == User.Identity.Name && item.WorkoutCompleted == false)
        {
            loggedInId = item.UserId;
        }
    }
    bool startNewWorkout = true;
    foreach (var item in Model)
    {
        if (loggedInId == item.User.UserId)
        {
            startNewWorkout = false;
            //currentWorkoutId allows to redirect to the Current Workout the user is at in the Progress view
            currentWorkoutId = item.UWId;
        }
    }
    //End of segment of code checking if active workouts exist

    //Link to start a new workout if startNewWorkout is true
    if (startNewWorkout == true)
    {
        @Html.ActionLink("Start Free Workout", "Create", "UserWorkout", new { @class = "btn btn-success", id = "IndexButton" })

        /* This is an alternative text option for starting new workouts
         *
        <h4>
            It looks like you don't have an Active Workout! <b>@Html.ActionLink("Start a New Workout Now!", "Create", null, new { @class = "LinkColor" })</b>
        </h4>
        */
    }

    //Button to resume workout if startNewWorkout is false
    if (startNewWorkout == false)
    {
        //Passes in the id of a users current workout and a false boolean value to the Progress function, since this is the workout button not attached to a plan
        @Html.ActionLink("Resume Current Workout", "Progress", "UserWorkouts", new { id = currentWorkoutId, fromPlan = false }, new { @class = "btn btn-success", id = "IndexButton" })
    }

    @*
                <!-- finalStage checks the current workout the user is on and is set to the number that is the last stage of the workout, so that
                    the user can complete it when they reach that point, this variable has to be coded based on how many steps each workout is-->
                <!--
                    CURRENT WORKOUTS:
                    UPPER-BODY HELLHOLE: ActiveWorkouts 1-3, Total of 3 Stages
                    BURNING BACK: ActiveWorkouts 4-6, Total of 3 Stages
                    BEG FULL BODY GYM: ActiveWorkouts 7-15, Total of 9 Stages
                    REST DAY: Active Workouts 16, Total of 1 Stage
                    BEG UPPER BODY GYM: Active Workouts 17-27, Total of 11 Stages
                    BEG LOWER BODY GYM: Active Workouts 28-32, Total of 5 Stages
                    BEG PUSH GYM: Active Workouts 33-38, Total of 6 Stages
                    BEG PULL GYM: Active Workouts 39-44, Total of 6 Stages
                    BEG LEGS GYM: Active Workouts 45-50, Total of 6 Stages
                    BEG CHEST: Active Workouts 51-58, Total of 8 Stages
                    BEG LEGS AND ABS GYM: Active Workouts 59-65, Total of 7 Stages
                    BEG SHOULDERS AND CALVES GYM: Active Workouts 66-69, Total of 4 Stages
                    BEG BACK BICEPS ABS GYM: Active Workouts 70-76, Total of 7 Stages
                    BEG BODYONLY CHEST ARMS: Active Workouts 77-82, Total of 6 Stages
                    BEG BODYONLY CORE: Active Workouts 83-89, Total of 7 Stages
                    BEG BODYONLY LEGS: Active Workouts 90-95, Total of 6 Stages
                -->

                <!-- If-statement checks currently logged in user with each user workout to prevent other users from seeing/editing anothers workout -->
                if (item.User.UserName == User.Identity.Name && item.WorkoutCompleted == false)
                {
                    <h3>How to do: @item.WorkoutExercise.Exercise.Instructions.ToString()</h3>
                    <h8>Reps and Sets</h8>

                    <h4>

                        <!--Completion Rewards-->
                        <hr />
                        <h5>Completion Rewards:</h5>

                        <!--temp variable used to hold the current workoutID to be used in API calls-->
                        <div id="currentWorkoutID" style="visibility: hidden">@item.WorkoutExercise.WorkoutId</div>

                        <img src="~/Content/images/icons/exp.png" alt="Experiences" style="height: 40px; width: 40px;" /> + <span id="Exp_Amount">0</span>
                        <hr />
                        <br />

                        <!--Completion Rewards END-->

                        @ViewBag.Testings
                    </h4>
                }

            }
        }
    *@

    <br />
    <br />
    <img src="~/Content/images/design_images/goblin_poison_blade.png" id="GoblinPoisonBlade" />
}

else
{
    <h1>User Workout Page</h1>
    <p>
        You must be @Html.ActionLink("Logged In", "Login", "Account", routeValues: null, htmlAttributes: new { id = "loginLink" })
        to view or start your Workout.
    </p>
}

<br /><br />
<p>Not working out right now? <b>@Html.ActionLink("View your Workout History!", "History", null, new { @class = "LinkColor" })</b></p>

@Scripts.Render("~/Scripts/workoutRewards.js")